<?xml version="1.0" encoding="UTF-8"?>
<template:library guid="3A28AEB962E304791DB307EB398D88089C730533"
  xmlns:template="http://schemas.unitedplanet.de/intrexx/2009/scriptTemplates/">
  <template:title>
    <template:item lang="de">Reports für Intrexx</template:item>
    <template:item lang="en">Reports for Intrexx</template:item>
  </template:title>
  <template:description>
    <template:item lang="de">JavaScript Bibliothek der QuinScape GmbH für Reports für Intrexx
      © QuinScape GmbH 2019
    </template:item>
    <template:item lang="en">JavaScript Library by QuinScape GmbH for Reports for Intrexx
      © QuinScape GmbH 2019
    </template:item>
  </template:description>
  <template:link>https://www.quinscape.de/reports</template:link>
  <template:template guid="9CCE404B66C3639B5D22EFA6227945CE60072389">
    <template:title>
      <template:item lang="de">Servlet-Aufruf (nicht empfohlen)</template:item>
      <template:item lang="en">Servlet call (deprecated)</template:item>
    </template:title>
    <template:description>
      <template:item lang="de">Bindet den Reports-Servlet Aufruf an eine Schaltfläche.
        Erwartet als Parameter die Schaltfläche:
        makeReportServletCall(this);
      </template:item>
      <template:item lang="en">Binds the Reports servlet to a button.
        Expects the button to bind to as it's parameter.
      </template:item>
    </template:description>
    <template:text>
<![CDATA[function makeReportServletCall(oHtmlActionControl)
{
  if(oHtmlActionControl &amp;&amp; oHtmlActionControl.oUp &amp;&amp; oHtmlActionControl.oUp.oTarget)
  {
    var target = oHtmlActionControl.oUp.oTarget;
    target.addParam = Helper.setQsValueByParam("urn:schemas-unitedplanet-de:ixservlet:name", "reports",
    target.addParam);
  }
  return true;
}]]>
    </template:text>
  </template:template>
  <template:template guid="D2D742642416D2297D6B491001E26E7B5B734ED4">
    <template:title>
      <template:item lang="de">Servlet-XHR-Aufruf</template:item>
      <template:item lang="en">Servlet XHR call</template:item>
    </template:title>
    <template:description>
      <template:item lang="de">Bindet den Reports-Servlet Aufruf an eine Schaltfläche.
        Erwartet als Parameter die Schaltfläche und den Identifizierer des Reports (GUID oder Name):
        makeReportServletCall(this, 'my-report');
      </template:item>
      <template:item lang="en">Binds the Reports servlet to a button.
        Expects the button to bind to and the report's identifier as it's parameters.
      </template:item>
    </template:description>
    <template:text>
<![CDATA[function makeReportServletXhrCall(oActionControl, report)
{
  var xhr = new XMLHttpRequest();
  var url = Helper.setQsValueByParam("urn:schemas-unitedplanet-de:ixservlet:name", "reports");
  url = Helper.setQsValueByParam("rq_qsReport", report, url);
  xhr.open("POST", url);
  xhr.responseType = 'blob';
  var formData = new FormData(oActionControl.form);
  xhr.send(formData);
  xhr.onload = function(e)
  {
    if(this.status == 200)
    {
      var contentType = this.getResponseHeader('Content-Type');
      var blob = new Blob([this.response], {type: contentType});
      var a = document.createElement("a");
      a.style = "display: none";
      document.body.appendChild(a);
      var url = window.URL.createObjectURL(blob);
      a.href = url;
      var contentDisposition = this.getResponseHeader('Content-Disposition');
      var filename = contentDisposition.substring(contentDisposition.indexOf('filename=') +
      'filename='.length);
      a.download = filename;
      a.click();
      window.URL.revokeObjectURL(url);
    }
    else
    console.log("Error");
  };
}]]>
    </template:text>
  </template:template>
</template:library>
